# Cursor Rules for Music Soup - Project Organization & Maintenance

## ğŸ¯ Project Overview
This is a Node.js automation that syncs Apple Music and Spotify playlists into a Notion database. All code should align with the PRD requirements for flexibility, modularity, and API safety.

## ğŸ“ MANDATORY Directory Structure
Enforce the following project organization at ALL TIMES:

```
/
â”œâ”€â”€ ğŸ“‹ CORE APPLICATION (Root Level Only)
â”‚   â”œâ”€â”€ config.js                 # Centralized environment variable access
â”‚   â”œâ”€â”€ endpoints.js              # All API endpoint constants  
â”‚   â”œâ”€â”€ schema.js                 # Notion schema and response field definitions
â”‚   â”œâ”€â”€ spotifyClient.js          # Spotify API integration only
â”‚   â”œâ”€â”€ appleMusicClient.js       # Apple Music API integration only
â”‚   â”œâ”€â”€ notionClient.js           # Notion API integration only
â”‚   â”œâ”€â”€ syncOrchestrator.js       # Main orchestration logic
â”‚   â”œâ”€â”€ sync.js                   # Entry point for sync operations
â”‚   â””â”€â”€ webhook-server.js         # Webhook server for external integrations
â”‚
â”œâ”€â”€ ğŸ› ï¸ scripts/                   # ALL utility and debug scripts
â”‚   â”œâ”€â”€ get-spotify-token.js      # OAuth token generation
â”‚   â”œâ”€â”€ get-apple-music-user-token.js  # Apple Music user token helper
â”‚   â”œâ”€â”€ debug-config.js           # Configuration validation
â”‚   â”œâ”€â”€ debug-apple-key.js        # Apple Music key debugging
â”‚   â””â”€â”€ [any new utility scripts] # Future one-off helpers
â”‚
â”œâ”€â”€ ğŸ§ª tests/                     # ALL test files
â”‚   â”œâ”€â”€ integration-test.js       # API integration testing
â”‚   â”œâ”€â”€ spotify.test.js           # Spotify client tests (when created)
â”‚   â”œâ”€â”€ appleMusic.test.js        # Apple Music client tests (when created)
â”‚   â””â”€â”€ notion.test.js            # Notion client tests (when created)
â”‚
â”œâ”€â”€ ğŸ”§ utils/                     # Shared utilities only
â”‚   â”œâ”€â”€ logger.js                 # Central logging
â”‚   â””â”€â”€ [shared helpers only]     # Deduplication, date formatting, etc.
â”‚
â”œâ”€â”€ ğŸ“š docs/                      # ALL documentation
â”‚   â”œâ”€â”€ project-structure.md      # This structure guide
â”‚   â”œâ”€â”€ setup.md                  # Setup instructions
â”‚   â”œâ”€â”€ webhook-setup.md          # Webhook configuration
â”‚   â”œâ”€â”€ flyio-setup.md            # Deployment guide
â”‚   â”œâ”€â”€ initial-prd.md            # Original requirements
â”‚   â”œâ”€â”€ internal-readme.md        # Development notes
â”‚   â””â”€â”€ [any new documentation]   # Future docs go here
â”‚
â”œâ”€â”€ ğŸš€ deployment/                # ALL deployment files
â”‚   â”œâ”€â”€ Dockerfile                # Container configuration
â”‚   â”œâ”€â”€ fly.toml                  # Fly.io settings
â”‚   â””â”€â”€ [platform configs]       # Future deployment configs
â”‚
â””â”€â”€ âš™ï¸ .github/workflows/         # GitHub Actions only
    â””â”€â”€ sync-music.yml            # Automated workflows
```

## ğŸš« FILE PLACEMENT RULES - NEVER VIOLATE

### âŒ FORBIDDEN in Root Directory:
- âŒ Debug scripts (use `scripts/`)
- âŒ Test files (use `tests/`)
- âŒ Documentation files (use `docs/`)
- âŒ Deployment configs except package.json (use `deployment/`)
- âŒ Utility scripts (use `scripts/`)
- âŒ Any temporary files (clean up immediately)

### âœ… REQUIRED File Placement:

#### Core Application Files (Root Only):
- âœ… API clients: `*Client.js` in root
- âœ… Main logic: `syncOrchestrator.js`, `sync.js` in root
- âœ… Configuration: `config.js`, `endpoints.js`, `schema.js` in root
- âœ… Server: `webhook-server.js` in root

#### Scripts Directory (`scripts/`):
- âœ… ALL debugging scripts (`debug-*.js`)
- âœ… ALL token generation scripts (`get-*-token.js`)
- âœ… ALL one-off utilities and helpers
- âœ… Scripts README.md

#### Tests Directory (`tests/`):
- âœ… ALL test files (`*.test.js`, `integration-test.js`)
- âœ… ALL mock data and fixtures
- âœ… ALL testing utilities

#### Documentation Directory (`docs/`):
- âœ… ALL markdown files except main README.md
- âœ… ALL setup and configuration guides
- âœ… ALL internal documentation
- âœ… ALL deployment guides

#### Deployment Directory (`deployment/`):
- âœ… Dockerfile and container configs
- âœ… Platform-specific deployment files
- âœ… Infrastructure as code

#### Utils Directory (`utils/`):
- âœ… ONLY shared utilities used by multiple modules
- âœ… Logger, formatters, validators
- âœ… NO business logic or API-specific code

## ğŸ”§ File Creation Rules

### When Creating New Files:

#### Debug/Utility Scripts:
```javascript
// âœ… CORRECT: Create in scripts/
// File: scripts/debug-notion-schema.js
/**
 * Debug Notion Schema Validation
 * 
 * Utility script to validate Notion database schema
 * and check field mappings.
 */
```

#### Test Files:
```javascript
// âœ… CORRECT: Create in tests/
// File: tests/spotify-auth.test.js
/**
 * Spotify Authentication Tests
 * 
 * Integration tests for Spotify OAuth flow
 * and token management.
 */
```

#### Documentation:
```markdown
<!-- âœ… CORRECT: Create in docs/ -->
<!-- File: docs/troubleshooting.md -->
# Troubleshooting Guide

Common issues and solutions...
```

#### Core Application:
```javascript
// âœ… CORRECT: Core logic in root
// File: appleMusicV2Client.js (hypothetical)
/**
 * Apple Music API Client V2
 * 
 * Enhanced Apple Music API integration with improved
 * error handling and metadata processing.
 */
```

## ğŸ§¹ File Maintenance Rules

### Automatic Cleanup Requirements:
- âœ… Remove any temporary files immediately after use
- âœ… Move misplaced files to correct directories
- âœ… Update documentation when structure changes
- âœ… Keep directory README files current

### File Naming Conventions:
- âœ… API clients: `servicenameClient.js` (camelCase)
- âœ… Core modules: `camelCase.js`
- âœ… Scripts: `kebab-case.js` or `descriptive-name.js`
- âœ… Tests: `module-name.test.js`
- âœ… Docs: `kebab-case.md`

## ğŸ” Code Organization Rules

### Import Path Standards:
```javascript
// âœ… CORRECT: Relative imports from organized structure
const config = require('./config');                    // Root to root
const logger = require('./utils/logger');              // Root to utils
const debugConfig = require('./scripts/debug-config'); // Root to scripts

// âœ… CORRECT: From scripts/
const config = require('../config');                   // Scripts to root
const logger = require('../utils/logger');             // Scripts to utils

// âœ… CORRECT: From tests/
const spotifyClient = require('../spotifyClient');     // Tests to root
const logger = require('../utils/logger');             // Tests to utils
```

### Module Responsibilities:
- âœ… `*Client.js`: ONLY API calls and service-specific auth
- âœ… `config.js`: ONLY environment variable access
- âœ… `utils/`: ONLY shared, reusable utilities
- âœ… `scripts/`: ONLY one-off utilities and debugging
- âœ… `tests/`: ONLY testing code and fixtures

## ğŸ“ Documentation Requirements

### Required Documentation Updates:
- âœ… Update `docs/project-structure.md` when adding directories
- âœ… Update individual README files when adding scripts
- âœ… Document new file purposes in file headers
- âœ… Keep main README.md focused on high-level overview

### File Header Requirements:
```javascript
/**
 * [File Purpose in One Line]
 * 
 * [Detailed description of what this file does]
 * 
 * Dependencies: [list key dependencies]
 * Location Rationale: [why this file is in this directory]
 */
```

## ğŸš¨ Enforcement Rules

### Before Creating Any File:
1. âœ… Determine correct directory based on file purpose
2. âœ… Check if similar functionality already exists
3. âœ… Follow naming conventions
4. âœ… Add proper file header documentation
5. âœ… Update relevant README if needed

### Before Moving Files:
1. âœ… Verify no import dependencies will break
2. âœ… Update any affected documentation
3. âœ… Test that functionality still works
4. âœ… Update related README files

### Regular Maintenance:
- âœ… Review root directory monthly for misplaced files
- âœ… Ensure no business logic creeps into utils/
- âœ… Keep scripts/ organized and documented
- âœ… Remove obsolete files promptly

## ğŸ¯ Goals of This Structure

### Maintainability:
- Clear separation of concerns
- Predictable file locations
- Minimal cognitive load for navigation

### Scalability:
- Room for growth in each category
- Consistent patterns for new features
- Isolated changes to minimize impact

### Developer Experience:
- Quick file discovery
- Logical organization
- Self-documenting structure

---

**REMEMBER: This structure exists to make the codebase more maintainable and professional. Always follow these rules when creating, moving, or organizing files.**